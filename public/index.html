<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV de Vendas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        html.dark body { background-color: #020617; background-image: radial-gradient(circle at 1px 1px, #1e293b 1px, transparent 0); background-size: 20px 20px; }
        .custom-card { background-color: rgba(255, 255, 255, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        html.dark .custom-card { background-color: rgba(15, 23, 42, 0.6); border: 1px solid rgba(51, 65, 85, 0.5); }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 0.7; animation: fall 3s linear forwards; }
        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); } 100% { transform: translateY(110vh) rotate(720deg); } }
        .wheel-container { position: relative; width: 250px; height: 250px; margin: 20px auto; }
        .wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #ccc; position: relative; overflow: hidden; transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1); }
        .wheel-segment { position: absolute; width: 50%; height: 50%; background-color: #3b82f6; transform-origin: 100% 100%; }
        .wheel-segment:nth-child(2n) { background-color: #22c55e; }
        .segment-label { transform: skewY(0deg) rotate(calc(360deg / 10 / 2)) translate(70px, -10px); display: block; color: white; font-weight: bold; }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 20px solid #e11d48; z-index: 10; }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30px; height: 30px; background: white; border-radius: 50%; border: 5px solid #ccc; z-index: 5; }
    </style>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { 'brand-primary': '#3b82f6', 'brand-secondary': '#22c55e', 'dark-bg': '#020617', 'dark-card': '#0f172a' } } } }
    </script>
</head>
<body class="text-slate-800 dark:text-slate-200">

    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-sm mx-auto">
            <div class="absolute top-5 right-5">
                <button id="theme-toggle" type="button" class="text-slate-500 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-800/50 rounded-lg text-sm p-2.5">
                    <i id="theme-icon-sun" data-lucide="sun" class="w-5 h-5 hidden"></i>
                    <i id="theme-icon-moon" data-lucide="moon" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="main-login-box" class="custom-card p-8 rounded-2xl shadow-lg text-center">
                <div class="mx-auto mb-4 inline-block p-3 bg-brand-primary/20 rounded-full">
                    <i data-lucide="shopping-basket" class="w-8 h-8 text-brand-primary"></i>
                </div>
                <h1 id="login-store-name" class="text-2xl font-bold text-slate-900 dark:text-white mb-1">Sistema de Vendas</h1>
                <div id="first-run-view" class="hidden text-left"></div>
                <div id="store-selection-view" class="hidden">
                    <p class="text-slate-600 dark:text-slate-400 mb-8">Selecione a sua loja</p>
                    <div id="store-list" class="space-y-2"></div>
                </div>
                <div id="user-selection-view" class="hidden">
                    <p class="text-slate-600 dark:text-slate-400 mb-8">Quem está acessando?</p>
                    <div id="user-list" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                    <button id="back-to-stores" class="mt-6 text-sm text-slate-500 hover:text-brand-primary">Voltar para seleção de lojas</button>
                </div>
                <div id="password-view" class="hidden">
                    <div id="selected-user-info" class="mb-4"></div>
                    <form id="password-form">
                        <input type="password" id="password" class="w-full px-4 py-2 text-center text-lg bg-slate-100/50 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-700 rounded-lg" placeholder="Digite sua senha" required>
                        <p id="login-error" class="text-red-500 text-sm mt-2 h-5"></p>
                        <div class="mt-4 flex flex-col sm:flex-row gap-2 justify-center">
                            <button type="button" id="back-to-users" class="w-full sm:w-auto px-5 py-2.5 text-sm font-medium bg-slate-200/50 dark:bg-slate-700/50 rounded-lg border border-slate-300 dark:border-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700">Voltar</button>
                            <button type="submit" class="w-full sm:w-auto text-white bg-brand-primary hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Entrar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        <aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0 bg-dark-card border-r border-slate-800">
            <div class="h-full px-3 py-4 overflow-y-auto">
                <div class="flex flex-col items-center mb-6 pb-4 border-b border-slate-700">
                    <div id="user-icon" class="w-16 h-16 mb-2 rounded-full bg-brand-primary flex items-center justify-center text-white text-3xl font-bold"></div>
                    <h5 id="username-sidebar" class="text-xl font-semibold text-white"></h5>
                    <span id="store-name-sidebar" class="text-sm text-slate-400"></span>
                </div>
                <ul id="vendedor-menu" class="space-y-2 font-medium"></ul>
                <ul id="gerente-menu" class="space-y-2 font-medium"></ul>
            </div>
        </aside>
        <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-30 sm:hidden"></div>
        <div class="sm:ml-64">
            <header class="sticky top-0 bg-slate-100/80 dark:bg-dark-bg/80 backdrop-blur-sm z-20 border-b border-slate-200 dark:border-slate-800">
                <div class="p-4 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button id="mobile-menu-button" class="sm:hidden text-slate-600 dark:text-slate-300">
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>
                        <h2 id="current-view-title" class="text-xl font-bold text-slate-900 dark:text-white"></h2>
                    </div>
                     <div class="flex items-center gap-4">
                         <div id="store-switcher-container" class="hidden">
                              <select id="store-switcher-select" class="block w-full rounded-md border-slate-300 dark:border-slate-700 bg-slate-200 dark:bg-slate-800 text-sm py-1.5"></select>
                         </div>
                        <button id="theme-toggle-app" type="button" class="text-slate-500 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-800/50 focus:outline-none rounded-lg text-sm p-2.5">
                           <i id="theme-icon-sun-app" data-lucide="sun" class="w-5 h-5 hidden"></i>
                           <i id="theme-icon-moon-app" data-lucide="moon" class="w-5 h-5"></i>
                        </button>
                     </div>
                </div>
            </header>
            <main id="main-content" class="p-4 md:p-6">
                </main>
        </div>
    </div>
    
    <div id="modal-container"></div>
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden">
      <div class="custom-card rounded-lg shadow-xl w-full max-w-sm p-6 m-4 fade-in text-center">
        <p id="confirm-modal-message" class="mb-6"></p>
        <div class="flex justify-center gap-4">
          <button id="confirm-modal-cancel" class="px-5 py-2.5 text-sm font-medium bg-slate-200/50 dark:bg-slate-700/50 rounded-lg border border-slate-300 dark:border-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700">Cancelar</button>
          <button id="confirm-modal-confirm" class="text-white bg-red-600 hover:bg-red-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Confirmar</button>
        </div>
      </div>
    </div>
    <div id="finalize-order-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"></div>
    <div id="order-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden"></div>
    <div id="client-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden"></div>
    <div id="bonus-wheel-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden"></div>
    <div id="prize-won-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden"></div>
    <div id="whatsapp-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 hidden"></div>


    <script type="text/template" id="caixa-template">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2">
              <div class="custom-card p-6 rounded-lg">
                  <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Adicionar Item</h3>
                  <form id="add-item-form" class="space-y-4">
                       <div class="relative">
                          <label for="product-search" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Buscar Produto no Estoque</label>
                          <input type="text" id="product-search" class="mt-1 block w-full rounded-md border-slate-300 dark:border-slate-600 shadow-sm bg-slate-200/50 dark:bg-slate-800/50" autocomplete="off" placeholder="Digite para buscar...">
                          <div id="product-search-results" class="absolute z-10 w-full bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md mt-1 shadow-lg max-h-48 overflow-y-auto hidden"></div>
                      </div>
                      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div class="md:col-span-2">
                              <label for="item-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nome do Item/Serviço</label>
                              <input type="text" id="item-name" class="mt-1 block w-full rounded-md border-slate-300 dark:border-slate-600 shadow-sm bg-slate-200/50 dark:bg-slate-800/50" required>
                          </div>
                          <div>
                              <label for="item-value" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Valor (R$)</label>
                              <input type="number" id="item-value" class="mt-1 block w-full rounded-md border-slate-300 dark:border-slate-600 shadow-sm bg-slate-200/50 dark:bg-slate-800/50" step="0.01" required>
                          </div>
                      </div>
                      <div>
                          <label for="item-exchange" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Troca (Opcional)</label>
                          <input type="text" id="item-exchange" class="mt-1 block w-full rounded-md border-slate-300 dark:border-slate-600 shadow-sm bg-slate-200/50 dark:bg-slate-800/50" placeholder="Ex: 7 Dias, 15 Dias, etc.">
                      </div>
                      <div class="text-right">
                          <button type="submit" class="inline-flex items-center justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-brand-primary hover:bg-blue-700">
                              <i data-lucide="plus-circle" class="w-4 h-4 mr-2"></i> Adicionar ao Pedido
                          </button>
                      </div>
                  </form>
              </div>
          </div>
          <div>
              <div class="custom-card p-6 rounded-lg sticky top-20">
                  <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Pedido Atual</h3>
                  <div id="current-order-items" class="space-y-3 mb-4 max-h-96 overflow-y-auto">
                      <p id="no-items-message" class="text-slate-500 dark:text-slate-400 text-center py-4">Nenhum item adicionado.</p>
                  </div>
                  <div class="border-t border-slate-300 dark:border-slate-700 pt-4">
                      <div class="flex justify-between items-center text-xl font-bold">
                          <span class="text-slate-800 dark:text-slate-200">Total:</span>
                          <span id="current-order-total" class="text-brand-primary">R$ 0,00</span>
                      </div>
                      <button id="finalize-order-button" class="mt-4 w-full bg-brand-secondary text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed" disabled>Finalizar Pedido</button>
                  </div>
              </div>
          </div>
      </div>
    </script>
    <script type="text/template" id="pedidos-template">
        <div class="space-y-6">
            <div id="vendedor-pedidos-dashboard" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Pedidos Finalizados</p><p id="pedidos-finalizados" class="text-2xl font-bold">0</p></div>
                <div class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Valor Total</p><p id="valor-total" class="text-2xl font-bold">R$ 0,00</p></div>
                <div class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Ticket Médio</p><p id="ticket-medio" class="text-2xl font-bold">R$ 0,00</p></div>
            </div>
            <div class="custom-card p-6 rounded-lg">
                <form id="filter-form" class="flex flex-wrap items-end gap-4">
                    <div id="gerente-vendedor-filter-container" class="hidden flex-grow"><label for="filter-vendedor" class="block text-sm">Vendedor</label><select id="filter-vendedor" class="block w-full rounded-md border-slate-300 dark:border-slate-700 bg-slate-200/50 dark:bg-slate-800/50"></select></div>
                    <div class="flex-grow"><label for="filter-date" class="block text-sm">Data</label><input type="date" id="filter-date" class="block w-full rounded-md border-slate-300 dark:border-slate-700 bg-slate-200/50 dark:bg-slate-800/50"></div>
                    <div class="flex-grow"><label for="filter-payment" class="block text-sm">Pagamento</label><select id="filter-payment" class="block w-full rounded-md border-slate-300 dark:border-slate-700 bg-slate-200/50 dark:bg-slate-800/50"><option value="Todos">Todos</option><option value="Pix">Pix</option><option value="Dinheiro">Dinheiro</option><option value="Cartão">Cartão</option></select></div>
                    <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md">Filtrar</button>
                    <button type="reset" class="bg-slate-300 dark:bg-slate-600 py-2 px-4 rounded-md">Limpar</button>
                </form>
            </div>
            <div class="custom-card rounded-lg overflow-hidden"><table class="w-full text-sm"><thead><tr id="orders-table-header-row"><th scope="col" class="px-6 py-3">Cliente</th><th scope="col" class="px-6 py-3">Data</th><th scope="col" class="px-6 py-3">Pagamento</th><th scope="col" class="px-6 py-3 text-right">Total</th><th scope="col" class="px-6 py-3 text-center">Ações</th></tr></thead><tbody id="orders-table-body"></tbody></table></div>
        </div>
    </script>
    <script type="text/template" id="clientes-template">
        <div class="space-y-6">
            <div class="custom-card p-6 rounded-lg">
                <h3 id="client-form-title" class="text-lg font-semibold mb-4">Adicionar Novo Cliente</h3>
                <form id="add-client-form" class="space-y-4">
                    <input type="hidden" id="client-form-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="client-form-name" class="block text-sm">Nome Completo</label><input type="text" id="client-form-name" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50" required></div>
                        <div><label for="client-form-phone" class="block text-sm">Telefone (WhatsApp)</label><input type="tel" id="client-form-phone" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <div><label for="client-form-email" class="block text-sm">Email</label><input type="email" id="client-form-email" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <div><label for="client-form-address" class="block text-sm">Endereço</label><input type="text" id="client-form-address" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    </div>
                    <div class="flex justify-end gap-3 pt-2">
                        <button type="reset" id="client-form-cancel" class="py-2 px-4 rounded-md text-sm hidden">Cancelar</button>
                        <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md"><span id="client-form-btn-text">Salvar Cliente</span></button>
                    </div>
                </form>
            </div>
             <div class="custom-card p-6 rounded-lg">
                <div class="flex flex-wrap items-end gap-4">
                    <div class="flex-grow"><label for="client-search" class="block text-sm">Buscar Cliente</label><input type="search" id="client-search" placeholder="Buscar por nome ou telefone..." class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                </div>
                 <form id="client-filter-form" class="mt-4 border-t pt-4 border-slate-300 dark:border-slate-700 flex flex-wrap items-end gap-4">
                     <div class="flex-grow"><label for="filter-last-purchase" class="block text-sm">Comprou no dia</label><input type="date" id="filter-last-purchase" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                     <div class="flex-grow"><label for="filter-product-purchased" class="block text-sm">Comprou o produto</label><input type="text" id="filter-product-purchased" placeholder="Nome do produto" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                     <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md">Filtrar</button>
                     <button type="reset" class="bg-slate-300 dark:bg-slate-600 py-2 px-4 rounded-md">Limpar</button>
                 </form>
            </div>
            <div class="custom-card rounded-lg overflow-hidden">
                <p id="client-count" class="px-6 py-2 text-sm text-slate-500"></p>
                <table class="w-full text-sm"><thead><tr><th class="px-6 py-3">Nome</th><th class="px-6 py-3">Telefone</th><th class="px-6 py-3 text-center">Contato</th><th class="px-6 py-3 text-center">Ações</th></tr></thead><tbody id="clients-table-body"></tbody></table>
            </div>
        </div>
    </script>
    <script type="text/template" id="metas-template">
        <div class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="custom-card p-6 rounded-lg">
                    <h4 class="font-bold mb-2">Meta Diária</h4>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-4"><div id="progresso-diario-barra" class="bg-brand-primary h-4 rounded-full" style="width: 0%"></div></div>
                    <p id="progresso-diario-texto" class="text-sm text-right mt-2">R$ 0,00 / R$ 0,00</p>
                </div>
                <div class="custom-card p-6 rounded-lg">
                    <h4 class="font-bold mb-2">Meta Semanal</h4>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-4"><div id="progresso-semanal-barra" class="bg-brand-secondary h-4 rounded-full" style="width: 0%"></div></div>
                    <p id="progresso-semanal-texto" class="text-sm text-right mt-2">R$ 0,00 / R$ 0,00</p>
                </div>
                <div class="custom-card p-6 rounded-lg">
                    <h4 class="font-bold mb-2">Meta Mensal</h4>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-4"><div id="progresso-mensal-barra" class="bg-amber-500 h-4 rounded-full" style="width: 0%"></div></div>
                    <p id="progresso-mensal-texto" class="text-sm text-right mt-2">R$ 0,00 / R$ 0,00</p>
                </div>
            </div>
            <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4">Meus Recordes</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                    <div><p class="text-sm text-slate-500">Dias de Meta Batida</p><p id="recorde-dias-consecutivos" class="text-2xl font-bold">0</p></div>
                    <div><p class="text-sm text-slate-500">Melhor Dia</p><p id="recorde-melhor-dia" class="text-2xl font-bold">R$ 0,00</p></div>
                    <div><p class="text-sm text-slate-500">Melhor Semana</p><p id="recorde-melhor-semana" class="text-2xl font-bold">R$ 0,00</p></div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/template" id="ranking-template">
        <div class="space-y-6">
          <div class="custom-card p-4 rounded-lg">
            <div class="flex justify-center bg-slate-200/50 dark:bg-slate-800/50 rounded-lg p-1">
              <button data-period="day" class="ranking-period-btn flex-1 py-2 px-4 rounded-md text-sm font-semibold bg-white dark:bg-slate-900 text-brand-primary shadow">Diário</button>
              <button data-period="week" class="ranking-period-btn flex-1 py-2 px-4 rounded-md text-sm font-semibold">Semanal</button>
              <button data-period="month" class="ranking-period-btn flex-1 py-2 px-4 rounded-md text-sm font-semibold">Mensal</button>
            </div>
          </div>
          <div id="ranking-podium-container" class="grid grid-cols-1"></div>
          <div id="ranking-list-container" class="space-y-2"></div>
        </div>
    </script>
    <script type="text/template" id="relatorios-template">
        <div class="space-y-6">
            <div id="gerente-relatorios-vendedor-select-container" class="hidden">
              <label for="relatorios-vendedor-select" class="text-sm font-medium">Visualizando Relatório de:</label>
              <select id="relatorios-vendedor-select" class="mt-1 block w-full md:w-1/3 rounded-md border-slate-300 dark:border-slate-700 bg-slate-200 dark:bg-slate-800 text-sm py-1.5"></select>
            </div>
            <div id="intelligent-summary" class="mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div id="vendas-hoje-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Vendas Hoje</p><p id="relatorio-vendas-hoje" class="text-2xl font-bold">R$ 0,00</p></div>
                <div id="vendas-semana-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Vendas na Semana</p><p id="relatorio-vendas-semana" class="text-2xl font-bold">R$ 0,00</p></div>
                <div id="vendas-mes-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Vendas no Mês</p><p id="relatorio-vendas-mes" class="text-2xl font-bold">R$ 0,00</p></div>
                <div id="comissao-hoje-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Comissão Hoje</p><p id="relatorio-comissao-dia" class="text-2xl font-bold">R$ 0,00</p></div>
                <div id="comissao-semana-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Comissão na Semana</p><p id="relatorio-comissao-semana" class="text-2xl font-bold">R$ 0,00</p></div>
                <div id="comissao-mes-card" class="custom-card p-4 rounded-lg"><p class="text-sm text-slate-500">Comissão no Mês</p><p id="relatorio-comissao-mes" class="text-2xl font-bold">R$ 0,00</p></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <div class="lg:col-span-3 custom-card p-6 rounded-lg"><h3 class="font-semibold mb-4">Vendas nos Últimos 7 Dias</h3><div class="h-64"><canvas id="vendas-semana-chart"></canvas></div></div>
                <div class="lg:col-span-2 custom-card p-6 rounded-lg"><h3 class="font-semibold mb-4">Formas de Pagamento</h3><div class="h-64"><canvas id="pagamento-chart"></canvas></div></div>
            </div>
             <div id="ai-analysis-section" class="hidden custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white flex items-center gap-2"><i data-lucide="sparkles" class="w-5 h-5 text-amber-400"></i> Análise Inteligente</h3>
                <div id="ai-analysis-result-container" class="text-sm text-slate-600 dark:text-slate-400 space-y-2">
                    <p>Clique no botão para gerar insights sobre o período e vendedor selecionado.</p>
                </div>
                <button id="generate-ai-analysis-btn" class="mt-4 bg-brand-primary/20 text-brand-primary font-semibold py-2 px-4 rounded-md text-sm hover:bg-brand-primary/30">Gerar Análise</button>
            </div>
            <div id="intelligent-alerts" class="mt-6 space-y-3"></div>
        </div>
    </script>
    <script type="text/template" id="configuracoes-template">
        <div class="space-y-6">
            <div id="manage-stores-section" class="hidden">
                <div class="custom-card p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Gerenciar Lojas (Superadmin)</h3>
                    <form id="add-store-form" class="flex items-end gap-2 mb-4">
                        <div class="flex-grow">
                            <label for="new-store-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nome da Nova Loja</label>
                            <input type="text" id="new-store-name" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50" required>
                        </div>
                        <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md">Adicionar Loja</button>
                    </form>
                    <h4 class="text-md font-semibold mb-2">Lojas Existentes</h4>
                    <ul id="stores-management-list" class="space-y-2"></ul>
                </div>
            </div>
        
            <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-2 text-slate-900 dark:text-white">Configurações Gerais</h3>
                <div class="space-y-4">
                    <div>
                        <label for="config-store-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nome da Loja</label>
                        <input type="text" id="config-store-name" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50">
                    </div>
                    <div class="text-right">
                        <button id="save-settings-button" class="bg-brand-primary text-white py-2 px-4 rounded-md">Salvar Nome</button>
                    </div>
                </div>
            </div>

            <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Metas e Comissão</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label for="meta-diaria" class="block text-sm">Meta Diária (R$)</label><input type="number" id="meta-diaria" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    <div><label for="meta-semanal" class="block text-sm">Meta Semanal (R$)</label><input type="number" id="meta-semanal" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    <div><label for="meta-mensal" class="block text-sm">Meta Mensal (R$)</label><input type="number" id="meta-mensal" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                </div>
                <div class="mt-4 border-t border-slate-300 dark:border-slate-700 pt-4">
                    <div class="flex items-center gap-3">
                        <input id="enable-commission" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-brand-primary focus:ring-brand-primary">
                        <label for="enable-commission" class="text-sm font-medium">Habilitar Sistema de Comissão</label>
                    </div>
                    <div id="commission-percentage-container" class="mt-2 hidden">
                         <label for="commission-percentage" class="block text-sm">Porcentagem da Comissão (%)</label>
                         <input type="number" id="commission-percentage" step="0.1" class="mt-1 block w-full md:w-1/4 rounded-md bg-slate-200/50 dark:bg-slate-800/50">
                    </div>
                </div>
                <div class="text-right mt-4">
                    <button id="save-goals-button" class="bg-brand-primary text-white py-2 px-4 rounded-md">Salvar Metas e Comissão</button>
                </div>
            </div>

             <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Roleta de Bônus</h3>
                 <div class="flex items-center gap-3">
                    <input id="enable-bonus-wheel" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-brand-primary focus:ring-brand-primary">
                    <label for="enable-bonus-wheel" class="text-sm font-medium">Habilitar Roleta de Bônus por Venda</label>
                </div>
                <div id="bonus-wheel-config-container" class="hidden mt-4 pt-4 border-t border-slate-300 dark:border-slate-700">
                     <div>
                        <label for="bonus-wheel-min-value" class="block text-sm">Valor Mínimo da Venda para Girar (R$)</label>
                        <input type="number" id="bonus-wheel-min-value" step="0.01" class="mt-1 block w-full md:w-1/4 rounded-md bg-slate-200/50 dark:bg-slate-800/50">
                    </div>
                    <h4 class="text-md font-semibold mt-4 mb-2">Prêmios</h4>
                    <form id="add-prize-form" class="flex items-end gap-2 mb-4">
                        <div class="flex-grow"><label for="prize-name" class="text-sm">Nome do Prêmio</label><input type="text" id="prize-name" class="mt-1 w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <div><label for="prize-probability" class="text-sm">Chance (%)</label><input type="number" id="prize-probability" class="mt-1 w-24 rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <button type="submit" class="bg-slate-200 dark:bg-slate-600 py-2 px-3 rounded-md">Add</button>
                    </form>
                    <ul id="prizes-list" class="space-y-1 mb-2"></ul>
                    <p class="text-sm text-right">Probabilidade Total: <span id="total-probability" class="font-bold">0%</span></p>
                    <div class="text-right mt-4">
                         <button id="save-wheel-button" class="bg-brand-primary text-white py-2 px-4 rounded-md">Salvar Roleta</button>
                    </div>
                </div>
            </div>

            <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Gerenciar Usuários</h3>
                <form id="add-user-form" class="space-y-3 mb-6 pb-6 border-b border-slate-300 dark:border-slate-700">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="user-name" class="block text-sm">Nome do Usuário</label><input type="text" id="user-name" class="mt-1 w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <div><label for="user-password" class="block text-sm">Senha</label><input type="password" id="user-password" class="mt-1 w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    </div>
                    <div class="flex items-center gap-3">
                        <input id="create-as-manager" type="checkbox" class="h-4 w-4 rounded border-slate-300">
                        <label for="create-as-manager" class="text-sm">Criar como Gerente</label>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md">Adicionar Usuário</button>
                    </div>
                </form>
                <h4 class="text-md font-semibold mb-2">Usuários da Loja</h4>
                <ul id="users-list" class="space-y-2"></ul>
            </div>
            
             <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Exportar Relatório de Vendas (.csv)</h3>
                <div class="space-y-4">
                     <div>
                        <label for="export-vendedor-select" class="block text-sm">Filtrar por Vendedor</label>
                        <select id="export-vendedor-select" class="mt-1 block w-full md:w-1/2 rounded-md bg-slate-200/50 dark:bg-slate-800/50"></select>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="export-today-btn" class="bg-slate-200 dark:bg-slate-600 py-2 px-4 rounded-md text-sm">Exportar Hoje</button>
                        <button id="export-week-btn" class="bg-slate-200 dark:bg-slate-600 py-2 px-4 rounded-md text-sm">Exportar Semana</button>
                        <button id="export-month-btn" class="bg-slate-200 dark:bg-slate-600 py-2 px-4 rounded-md text-sm">Exportar Mês</button>
                    </div>
                    <div class="flex items-end gap-2 pt-4 border-t border-slate-300 dark:border-slate-700">
                        <div class="flex-grow"><label for="start-date" class="text-sm">De:</label><input type="date" id="start-date" class="w-full mt-1 rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <div class="flex-grow"><label for="end-date" class="text-sm">Até:</label><input type="date" id="end-date" class="w-full mt-1 rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                        <button id="export-range-btn" class="bg-brand-primary text-white py-2 px-4 rounded-md text-sm">Exportar Período</button>
                    </div>
                </div>
            </div>
            
            <div class="custom-card p-6 rounded-lg border-l-4 border-red-500 bg-red-50 dark:bg-red-900/20">
                <h3 class="text-lg font-semibold text-red-800 dark:text-red-300">Zona de Perigo</h3>
                <p class="text-sm text-red-700 dark:text-red-400 mt-2 mb-4">A ação abaixo é irreversível. Tenha certeza do que está fazendo.</p>
                <button id="delete-all-sales-button" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Zerar Vendas da Loja</button>
            </div>
        </div>
    </script>
    <script type="text/template" id="financeiro-template">
        <div class="space-y-6">
            <div class="custom-card p-4 rounded-lg">
                <form id="financeiro-filter-form" class="flex flex-wrap items-end gap-4">
                    <div class="flex-grow"><label for="financeiro-start-date" class="block text-sm">Data de Início</label><input type="date" id="financeiro-start-date" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    <div class="flex-grow"><label for="financeiro-end-date" class="block text-sm">Data de Fim</label><input type="date" id="financeiro-end-date" class="mt-1 block w-full rounded-md bg-slate-200/50 dark:bg-slate-800/50"></div>
                    <button type="submit" class="bg-brand-primary text-white py-2 px-4 rounded-md">Filtrar</button>
                    <button type="reset" class="bg-slate-300 dark:bg-slate-600 py-2 px-4 rounded-md">Limpar</button>
                    <button type="button" id="financeiro-filter-this-month" class="bg-slate-300 dark:bg-slate-600 py-2 px-4 rounded-md">Este Mês</button>
                </form>
            </div>

            <div id="financeiro-summary-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>

            <div class="custom-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Desempenho no Período</h3>
                <div class="h-80"><canvas id="financeiro-chart"></canvas></div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 custom-card p-6 rounded-lg space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold mb-2 text-slate-900 dark:text-white">Custos Variáveis e Fixos</h3>
                        <div class="space-y-2 mb-4 p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                            <h4 class="font-semibold text-sm">Custos Variáveis (automáticos)</h4>
                            <div class="flex items-center gap-2 text-sm">
                                <label for="cost-impostos" class="flex-shrink-0">Impostos (%):</label>
                                <input type="number" id="cost-impostos" value="0" class="financial-cost-input w-full rounded-md bg-slate-200/50 dark:bg-slate-700/50 p-1 text-sm">
                            </div>
                            <div class="flex items-center gap-2 text-sm">
                                <label for="cost-comissoes" class="flex-shrink-0">Comissões (%):</label>
                                <input type="number" id="cost-comissoes" value="5" class="financial-cost-input w-full rounded-md bg-slate-200/50 dark:bg-slate-700/50 p-1 text-sm">
                            </div>
                            <div class="flex items-center gap-2 text-sm">
                                <label for="cost-outros" class="flex-shrink-0">Outros (R$):</label>
                                <input type="number" id="cost-outros" value="0" class="financial-cost-input w-full rounded-md bg-slate-200/50 dark:bg-slate-700/50 p-1 text-sm">
                            </div>
                        </div>
                        <div class="space-y-2 p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                             <h4 class="font-semibold text-sm">Custos Fixos (mensais)</h4>
                             <ul id="fixed-costs-list" class="space-y-1 my-2"></ul>
                             <form id="add-fixed-cost-form" class="flex items-end gap-2 text-sm">
                                 <div class="flex-grow"><label for="fixed-cost-name">Descrição</label><input type="text" id="fixed-cost-name" class="mt-1 w-full rounded-md bg-slate-200/50 dark:bg-slate-700/50 p-1 text-sm"></div>
                                 <div class="w-28"><label for="fixed-cost-amount">Valor (R$)</label><input type="number" id="fixed-cost-amount" class="mt-1 w-full rounded-md bg-slate-200/50 dark:bg-slate-700/50 p-1 text-sm"></div>
                                 <button type="submit" class="bg-brand-secondary text-white py-1 px-3 rounded-md text-sm self-end">Add</button>
                             </form>
                        </div>
                    </div>
                    <div id="financeiro-net-summary" class="grid grid-cols-2 text-center gap-4 pt-4 border-t border-slate-300 dark:border-slate-700"></div>
                </div>
                
                <div class="custom-card p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Projeções</h3>
                    <div id="financeiro-projections" class="space-y-4 text-center"></div>
                </div>
            </div>
        </div>
    </script>
    <script type="module" src="firebase-init.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>